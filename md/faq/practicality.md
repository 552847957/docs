# 最佳实践
记录实际应用中的最佳实践方法。

## Q. 我们正在做红包功能，红包有已打开/未打开状态，能否修改IM消息中的已读/未读状态
A. 使用野火IM的一个原则就是：不能把业务逻辑强加于IM系统，需要保持IM服务的独立性。红包的已打开/未打开状态属于业务逻辑。应该把该状态保存在红包服务器，当红包消息显示时，如果本地没有该红包对应的状态，应该去红包服务器取回状态，取回之后判断如果已经打开，保存已打开状态下来，如果没有打开则不存储。之后每次显示红包消息时都根据本地保存的状态是否打开过，如果已经打开显示打开状态；如果未打开则再去红包服务器刷新。这样当多端登录或者更换手机后，状态也都能正确显示。（此逻辑仅供参考）

## Q. 如何添加内置动态表情，如果收藏表情，还有如何开发应用商店。
A。 请参考[小表情大世界](practicality/stickers.md)

## Q. 如何确保只有一个客户端登录？
A：IM服务是客户端与客户端/客户端与服务之间的通道，提供同一个用户多接入能力。只能有一个客户端登录属于应用行为，跟IM服务无关，需要在应用服务中实现。实现方法可以参考如下：

当一个新的客户端输入密码登录时
1. 应用服务保存当前客户端的clientId及平台。
2. 发一条登录手机变更的自定义通知消息给自己。

客户端去应用服务端检查登录许可，如果当前客户端不许可，则断开IM服务，登出当前应用。检查的时机如下：
1. 当客户端免密登录时。
2. 收到自定义消息的通知时。

另外需要注意的是需要支持不同平台的同时登录，一般应用都是可以支持移动端/PC端/Web端/小程序端同时登录，但不允许其中某一个端多机登录。（比如微信，支持手机/PC/Web同时登录，不支持两个手机或两个电脑同时登录）
